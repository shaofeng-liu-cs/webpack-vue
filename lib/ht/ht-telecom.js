!function(J,U){"use strict";var D=ht.AlarmSeverity=function(n,R,q,Z,p){this.value=n,this.name=R,this.nickName=q,this.color=Z,this.displayName=p};ht.Default.def("ht.AlarmSeverity",U,{toString:function(){return this.displayName||this.name}}),function(){D.severities=new ht.List,D._vm={},D._nm={},D._cp=function(P,l){if(P&&l){var p=P.value-l.value;return p>0?1:0>p?-1:0}return P&&!l?1:!P&&l?-1:0},D.each=function(S,s){D.severities.each(S,s)},D.getSortFunction=function(){return D._cp},D.setSortFunction=function(d){D._cp=d,D.severities.sort(d)},D.add=function(L,R,I,z,t){var v=new D(L,R,I,z,t);return D._vm[L]=v,D._nm[R]=v,D.severities.add(v),D.severities.sort(D._cp),v},D.remove=function(H){var X=D._nm[H];return X&&(delete D._nm[H],delete D._vm[X.value],D.severities.remove(X)),X},D.CRITICAL=D.add(500,"Critical","C","#FF0000"),D.MAJOR=D.add(400,"Major","M","#FFA000"),D.MINOR=D.add(300,"Minor","m","#FFFF00"),D.WARNING=D.add(200,"Warning","W","#00FFFF"),D.INDETERMINATE=D.add(100,"Indeterminate","N","#C800FF"),D.CLEARED=D.add(0,"Cleared","R","#00FF00"),D.isClearedAlarmSeverity=function(z){return z?0===z.value:!1},D.getByName=function(F){return D._nm[F]},D.getByValue=function(i){return D._vm[i]},D.clear=function(){D.severities.clear(),D._vm={},D._nm={}},D.compare=function(e,a){return D._cp(e,a)}}();var a=ht.AlarmState=function(c){this._d=c,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",U,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var f=null;for(var c in this._am)c=D.getByName(c),D.isClearedAlarmSeverity(c)||0!==this.getAcknowledgedAlarmCount(c)&&(f=f?D.compare(f,c)>0?f:c:c);this._haa=f},_c2:function(){var H=null;for(var U in this._nm)U=D.getByName(U),D.isClearedAlarmSeverity(U)||0!==this.getNewAlarmCount(U)&&(H=H?D.compare(H,U)>0?H:U:U);this._hna=H},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var J in this._nm)if(J=D.getByName(J),!D.isClearedAlarmSeverity(J)&&0!==this.getNewAlarmCount(J)&&D.compare(this._hna,J)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var Q=this._haa,T=this._hna,K=this._ps;this._hoa=Q,D.compare(T,this._hoa)>0&&(this._hoa=T),D.compare(K,this._hoa)>0&&(this._hoa=K)},_c5:function(){var A=this._haa,r=this._hna;this._hta=A,D.compare(r,this._hta)>0&&(this._hta=r)},increaseAcknowledgedAlarm:function(w,I){if(0!==I){I=I||1;var N=this._am[w.name]||0;N+=I,this._am[w.name]=N,this._f()}},increaseNewAlarm:function(P,h){if(0!==h){h=h||1;var g=this._nm[P.name]||0;g+=h,this._nm[P.name]=g,this._f()}},decreaseAcknowledgedAlarm:function(J,f){if(0!==f){f||(f=1);var x=this._am[J.name]||0;if(x-=f,0>x)throw"Alarm count can not be negative";this._am[J.name]=x,this._f()}},decreaseNewAlarm:function(n,g){if(0!==g){g||(g=1);var c=this._nm[n.name]||0;if(c-=g,0>c)throw"Alarm count can not be negative";this._nm[n.name]=c,this._f()}},acknowledgeAlarm:function(l){this.decreaseNewAlarm(l,1),this.increaseAcknowledgedAlarm(l,1)},acknowledgeAllAlarms:function(T){if(T){var I=this.getNewAlarmCount(T);this.decreaseNewAlarm(T,I),this.increaseAcknowledgedAlarm(T,I)}else for(var j in this._nm)this.acknowledgeAllAlarms(D.getByName(j))},_c6:function(){this._aac=0;for(var H in this._am)H=D.getByName(H),this._aac+=this.getAcknowledgedAlarmCount(H)},getAcknowledgedAlarmCount:function(A){return A?this._am[A.name]||0:this._aac},getAlarmCount:function(k){return this.getAcknowledgedAlarmCount(k)+this.getNewAlarmCount(k)},_c7:function(){this._nac=0;for(var v in this._nm)this._nac+=this.getNewAlarmCount(D.getByName(v))},getNewAlarmCount:function(a){return a?this._nm[a.name]||0:this._nac},setNewAlarmCount:function(F,K){this._nm[F.name]=K,this._f()},removeAllNewAlarms:function(x){x?delete this._nm[x]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(U,s){this._am[U.name]=s,this._f()},removeAllAcknowledgedAlarms:function(Y){Y?delete this._am[Y.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(o){if(this._ep||(o=null),this._ps!==o){var B=this._ps;this._ps=o,this._f(),this._d.fp("propagateSeverity",B,o)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(D){var A=this._ep;this._ep=D,this._d.fp("enablePropagation",A,D)&&(D||this.setPropagateSeverity(null))}});var N=ht.AlarmStatePropagator=function(E){this._dataModel=E,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",U,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(b){this._enable!==b&&(this._enable=b,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(Z){this.propagate(Z)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(y){y.data&&this.propagate(y.data)},handleDataPropertyChange:function(C){if("alarmState"===C.property||"enablePropagation"===C.property)this.propagate(C.data);else if("parent"===C.property){var T=C.oldValue;T&&this.propagate(T),this.propagate(C.data)}},propagate:function(q){q&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(q),this._isPropagating=!1)},propagateToTop:function(S){for(this.propagateToParent(null,S);S&&S.getParent();)this.propagateToParent(S,S.getParent()),S=S.getParent()},propagateToParent:function(H,C){var S=null;C.getChildren().each(function(Q){var K=Q.getAlarmState().getHighestOverallAlarmSeverity();D.compare(K,S)>0&&(S=K)}),C.getAlarmState().setPropagateSeverity(S)}}),ht.AlarmStateStatistics=function(I){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(I)},ht.Default.def("ht.AlarmStateStatistics",U,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(K){var S=this._dataModel;S!==K&&(S&&(S.umd(this.handleDataPropertyChange,this),S.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=K,this.reset(),K.md(this.handleDataPropertyChange,this),K.mm(this.handleDataModelChange,this),this.fp("dataModel",S,K))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(J){"alarmState"===J.property&&(this.increase(J.data),this.fireAlarmStateChange())},handleDataModelChange:function(x){"add"===x.kind?(this.increase(x.data),this.fireAlarmStateChange()):"remove"===x.kind?(this.decrease(x.data),this.fireAlarmStateChange()):"clear"===x.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,D.each(function(D){var K=this.getSumInfo(D);this.sumAcked+=K.ackedCount,this.sumNew+=K.newCount,this.sumTotal+=K.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(L){if(!L)return this.sumNew;var h=this.getSumInfo(L);return h.newCount},getAcknowledgedAlarmCount:function(o){if(!o)return this.sumAcked;var f=this.getSumInfo(o);return f.ackedCount},getTotalAlarmCount:function(u){if(!u)return this.sumTotal;var P=this.getSumInfo(u);return P.totalCount},getSumInfo:function(o){var c=this.severtiyMap[o.name];return c||(c={},c.newCount=0,c.ackedCount=0,c.totalCount=0,this.severtiyMap[o.name]=c),c},decrease:function(K){var t=this.dataMap[K.getId()];t&&(delete this.dataMap[K.getId()],D.each(function(O){var k=t[O.name],N=this.getSumInfo(O);N.newCount=N.newCount-k.newCount,N.ackedCount=N.ackedCount-k.ackedCount,N.totalCount=N.totalCount-k.totalCount},this))},increase:function(N){if(this.decrease(N),!this._filterFunc||this._filterFunc(N)){var r={},K=N.getAlarmState();this.dataMap[N.getId()]=r,D.each(function(V){var J={};J.newCount=K.getNewAlarmCount(V),J.ackedCount=K.getAcknowledgedAlarmCount(V),J.totalCount=K.getAlarmCount(V),r[V.name]=J;var c=this.getSumInfo(V);c.newCount=c.newCount+J.newCount,c.ackedCount=c.ackedCount+J.ackedCount,c.totalCount=c.totalCount+J.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(m){var t=this._filterFunc;this._filterFunc=m,this.reset(),this.firePropertyChange("filterFunc",t,m)},getFilterFunc:function(){return this._filterFunc}});var n=ht.Data.prototype;n.getAlarmState=function(){return this._alarmState||(this._alarmState=new a(this))},n=ht.DataModel.prototype,n.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},n.setEnableAlarmStatePropagator=function(c){c!=this.isEnableAlarmStatePropagator()&&(c?(this._alarmStatePropagator=new N(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},n=ht.graph.GraphView.prototype,n.getNote2=function(y){var i=y.getAlarmState().getHighestNewAlarmSeverity();if(i){var N=y.getAlarmState().getNewAlarmCount(i)+i.nickName;return y.getAlarmState().hasLessSevereNewAlarms()&&(N+="+"),N}return y.s("note2")},n.getNote2Background=function(N){var u=N.getAlarmState().getHighestNewAlarmSeverity();return u?u.color:N.s("note2.background")},n.getBodyColor=function(r){var b=r.getAlarmState().getHighestNativeAlarmSeverity();return b?b.color:r.s("body.color")},n.getBorderColor=function(E){var N=E.getAlarmState().getPropagateSeverity();return N?N.color:E.s("border.color")},n=ht.widget.TreeView.prototype,n.getBorderColor=function(v){var h=v.getAlarmState().getPropagateSeverity();return h?h.color:v.s("border.color")},n.getIcon=function(t){return t.getIcon()?"__alarmIcon__":null},n=ht.widget.TreeTableView.prototype,n.getBorderColor=function(v){var w=v.getAlarmState().getPropagateSeverity();return w?w.color:v.s("border.color")},n.getIcon=function(E){return E.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(R){return R.getIcon()}},color:{func:function(n){var m=n.getAlarmState().getHighestNativeAlarmSeverity();return m?m.color:n.s("body.color")}},rect:[0,0,16,16]}]});var b=ht.Style;b["note2.expanded"]=!0,b["note2.color"]="#000"}(this,Object);